(()=>{var e={139:(e,t,s)=>{const{getValue:r,setValue:n,removeValue:o,lockKey:a}=s(116);async function run(e){const t=e.getInput("state",{required:true});const s=e.getInput("key",{required:true});const r=e.getInput("value");const n=e.getInput("host",{required:true});const o=e.getInput("port",{required:true});const a=e.getInput("scheme",{required:true});const i=e.getInput("ca");const c=e.getInput("dc");const u=e.getInput("token");const l=e.getInput("recurse");const d=e.getInput("retrieve");const f=e.getInput("session");const p=e.getInput("cas");const h={host:n,port:o,secure:a==="https",ca:i!==""?i:null,dc:c!==""?c:null,token:u!==""?u:null};const y={key:s,value:r,recurse:l==="true",retrieve:d==="true",session:f,cas:p!==""?p:null};let m;try{m=await execute(t,h,y)}catch(t){e.setFailed(t.message)}output(e,m,"changed");output(e,m,"data");output(e,m,"flags");output(e,m,"index")}function output(e,t,s){if(!Object.prototype.hasOwnProperty.call(t,s)){return}e.setOutput(s,t[s]);e.info(`Set ${s}: ${JSON.stringify(t[s])}`)}async function execute(e,t,s){if(e==="acquire"){if(!s.session){throw new Error(`${e} of lock for ${s.key} requested but no session supplied`)}return await a(t,s.session,s.key,s.value,true,s.cas)}if(e==="release"){if(!s.session){throw new Error(`${e} of lock for ${s.key} requested but no session supplied`)}return await a(t,s.session,s.key,s.value,false,s.cas)}if(e==="present"){if(s.value===""){return await r(t,s.key,s.recurse)}return await n(t,s.key,s.value,s.retrieve)}if(e==="absent"){return await o(t,s.key,s.recurse)}throw new Error(`Unsupported state: ${e}`)}e.exports={execute:execute,run:run}},116:(e,t,s)=>{const r=s(519);function getConsul(e){const t={host:e.host||"localhost",port:parseInt(e.port,10)||8500,secure:e.secure||false,defaults:{recurse:e.recurse||false}};if(e.ca){t.ca=[e.ca]}if(e.dc){t.defaults.dc=e.dc}if(e.token){t.defaults.token=e.token}return new r(t)}async function hasValueChanged(e,t,s){const r=await e.kv.get(t);if(!r){return{changed:true}}return{changed:r.Value!==s,index:r.ModifyIndex}}function putValueByPath(e,t,s,r){const n=t.split(s);let o=e;for(const e of n.slice(0,-1)){if(!Object.prototype.hasOwnProperty.call(o,e)){o[e]={}}o=o[e]}o[n.slice(-1)]=r}async function getValue(e,t,s=false){const r=getConsul(e);const n=await r.kv.get({key:t,recurse:s});if(!n){return{changed:false}}if(Array.isArray(n)){let e=new RegExp(`^${t}/?`,"u");let s={};for(const t of n){const r=t.Key.replace(e,"");putValueByPath(s,r,"/",t.Value)}return{changed:false,data:s}}return{changed:false,data:n.Value,flags:n.Flags,index:n.ModifyIndex}}async function setValue(e,t,s,r=true){const n=getConsul(e);const{changed:o,index:a}=await hasValueChanged(n,t,s);if(o){await n.kv.set(t,s)}if(r){const e=await n.kv.get(t);return{changed:o,data:e.Value,flags:e.Flags,index:e.ModifyIndex}}const i={changed:o};if(a){i.index=a}return i}async function removeValue(e,t,s=false){const r=getConsul(e);const n={changed:false};if(s){const e=await r.kv.keys(t);n.changed=!!e.length}else{const e=await r.kv.get(t);if(e){n.changed=true;n.data=e.Value;n.index=e.ModifyIndex}}if(n.changed){await r.kv.del({key:t,recurse:s})}return n}async function lockKey(e,t,s,r,n,o=null){const a={key:s,value:r};const i=getConsul(e);let{changed:c,index:u}=await hasValueChanged(i,s,r);if(n){a.acquire=t}else{a.release=t}if(o!==null){a.cas=o}if(!n&&u){c=true}if(c){const e=await i.kv.set(a);c=n?!!e:true;if(n&&e&&!u){const e=await i.kv.get(s);if(e){u=e.ModifyIndex}}}if(u){return{changed:c,index:u}}return{changed:c}}e.exports={hasValueChanged:hasValueChanged,getValue:getValue,setValue:setValue,removeValue:removeValue,lockKey:lockKey}},351:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){if(r===undefined)r=s;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[s]}})}:function(e,t,s,r){if(r===undefined)r=s;e[r]=t[s]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)if(s!=="default"&&Object.hasOwnProperty.call(e,s))r(t,e,s);n(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.issue=t.issueCommand=void 0;const a=o(s(87));const i=s(278);function issueCommand(e,t,s){const r=new Command(e,t,s);process.stdout.write(r.toString()+a.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const c="::";class Command{constructor(e,t,s){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=s}toString(){let e=c+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const s in this.properties){if(this.properties.hasOwnProperty(s)){const r=this.properties[s];if(r){if(t){t=false}else{e+=","}e+=`${s}=${escapeProperty(r)}`}}}}e+=`${c}${escapeData(this.message)}`;return e}}function escapeData(e){return i.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return i.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},186:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){if(r===undefined)r=s;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[s]}})}:function(e,t,s,r){if(r===undefined)r=s;e[r]=t[s]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)if(s!=="default"&&Object.hasOwnProperty.call(e,s))r(t,e,s);n(t,e);return t};var a=this&&this.__awaiter||function(e,t,s,r){function adopt(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function fulfilled(e){try{step(r.next(e))}catch(e){n(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){n(e)}}function step(e){e.done?s(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:true});t.getState=t.saveState=t.group=t.endGroup=t.startGroup=t.info=t.warning=t.error=t.debug=t.isDebug=t.setFailed=t.setCommandEcho=t.setOutput=t.getBooleanInput=t.getMultilineInput=t.getInput=t.addPath=t.setSecret=t.exportVariable=t.ExitCode=void 0;const i=s(351);const c=s(717);const u=s(278);const l=o(s(87));const d=o(s(622));var f;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(f=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){const s=u.toCommandValue(t);process.env[e]=s;const r=process.env["GITHUB_ENV"]||"";if(r){const t="_GitHubActionsFileCommandDelimeter_";const r=`${e}<<${t}${l.EOL}${s}${l.EOL}${t}`;c.issueCommand("ENV",r)}else{i.issueCommand("set-env",{name:e},s)}}t.exportVariable=exportVariable;function setSecret(e){i.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){const t=process.env["GITHUB_PATH"]||"";if(t){c.issueCommand("PATH",e)}else{i.issueCommand("add-path",{},e)}process.env["PATH"]=`${e}${d.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const s=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!s){throw new Error(`Input required and not supplied: ${e}`)}if(t&&t.trimWhitespace===false){return s}return s.trim()}t.getInput=getInput;function getMultilineInput(e,t){const s=getInput(e,t).split("\n").filter((e=>e!==""));return s}t.getMultilineInput=getMultilineInput;function getBooleanInput(e,t){const s=["true","True","TRUE"];const r=["false","False","FALSE"];const n=getInput(e,t);if(s.includes(n))return true;if(r.includes(n))return false;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}\n`+`Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}t.getBooleanInput=getBooleanInput;function setOutput(e,t){process.stdout.write(l.EOL);i.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setCommandEcho(e){i.issue("echo",e?"on":"off")}t.setCommandEcho=setCommandEcho;function setFailed(e){process.exitCode=f.Failure;error(e)}t.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}t.isDebug=isDebug;function debug(e){i.issueCommand("debug",{},e)}t.debug=debug;function error(e){i.issue("error",e instanceof Error?e.toString():e)}t.error=error;function warning(e){i.issue("warning",e instanceof Error?e.toString():e)}t.warning=warning;function info(e){process.stdout.write(e+l.EOL)}t.info=info;function startGroup(e){i.issue("group",e)}t.startGroup=startGroup;function endGroup(){i.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return a(this,void 0,void 0,(function*(){startGroup(e);let s;try{s=yield t()}finally{endGroup()}return s}))}t.group=group;function saveState(e,t){i.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},717:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){if(r===undefined)r=s;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[s]}})}:function(e,t,s,r){if(r===undefined)r=s;e[r]=t[s]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)if(s!=="default"&&Object.hasOwnProperty.call(e,s))r(t,e,s);n(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.issueCommand=void 0;const a=o(s(747));const i=o(s(87));const c=s(278);function issueCommand(e,t){const s=process.env[`GITHUB_${e}`];if(!s){throw new Error(`Unable to find environment variable for file command ${e}`)}if(!a.existsSync(s)){throw new Error(`Missing file at path: ${s}`)}a.appendFileSync(s,`${c.toCommandValue(t)}${i.EOL}`,{encoding:"utf8"})}t.issueCommand=issueCommand},278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.toCommandValue=void 0;function toCommandValue(e){if(e===null||e===undefined){return""}else if(typeof e==="string"||e instanceof String){return e}return JSON.stringify(e)}t.toCommandValue=toCommandValue},11:(e,t,s)=>{const r=s(21).w;const n=s(321);class Acl{constructor(e){this.consul=e;this.legacy=new Acl.Legacy(e)}async bootstrap(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.bootstrap",path:"/acl/bootstrap",type:"json"};n.options(t,e);return await this.consul._put(t,n.body)}async replication(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.replication",path:"/acl/replication",query:{}};n.options(t,e);return await this.consul._get(t,n.body)}}Acl.Legacy=r;t.W=Acl},21:(e,t,s)=>{const r=s(447);const n=s(321);class AclLegacy{constructor(e){this.consul=e}async create(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.create",path:"/acl/create",query:{},type:"json",body:{}};if(e.name)t.body.Name=e.name;if(e.type)t.body.Type=e.type;if(e.rules)t.body.Rules=e.rules;n.options(t,e);return await this.consul._put(t,n.body)}async update(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.update",path:"/acl/update",query:{},type:"json",body:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}t.body.ID=e.id;if(e.name)t.body.Name=e.name;if(e.type)t.body.Type=e.type;if(e.rules)t.body.Rules=e.rules;n.options(t,e);return await this.consul._put(t,n.empty)}async destroy(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.destroy",path:"/acl/destroy/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async info(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.info",path:"/acl/info/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._get(t,n.bodyItem)}get(...e){return this.info(...e)}async clone(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.clone",path:"/acl/clone/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.body)}async list(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"acl.legacy.list",path:"/acl/list",query:{}};n.options(t,e);return await this.consul._get(t,n.body)}}t.w=AclLegacy},282:(e,t,s)=>{const r=s(578).Q;const n=s(752).R;const o=s(447);const a=s(321);class Agent{constructor(e){this.consul=e;this.check=new Agent.Check(e);this.service=new Agent.Service(e)}checks(){return this.check.list.apply(this.check,arguments)}services(){return this.service.list.apply(this.service,arguments)}async members(e){e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.members",path:"/agent/members",query:{}};a.options(t,e);return await this.consul._get(t,a.body)}async reload(e){e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.reload",path:"/agent/reload"};a.options(t,e);return await this.consul._put(t,a.empty)}async self(e){e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.self",path:"/agent/self"};a.options(t,e);return await this.consul._get(t,a.body)}async maintenance(e){if(typeof e==="boolean"){e={enable:e}}e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.maintenance",path:"/agent/maintenance",query:{enable:e.enable}};if(typeof e.enable!=="boolean"){throw this.consul._err(o.Validation("enable required"),t)}if(e.reason)t.query.reason=e.reason;a.options(t,e);return await this.consul._put(t,a.empty)}async join(e){if(typeof e==="string"){e={address:e}}e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.join",path:"/agent/join/{address}",params:{address:e.address}};if(!e.address){throw this.consul._err(o.Validation("address required"),t)}a.options(t,e);return await this.consul._put(t,a.empty)}async forceLeave(e){if(typeof e==="string"){e={node:e}}e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"agent.forceLeave",path:"/agent/force-leave/{node}",params:{node:e.node}};if(!e.node){throw this.consul._err(o.Validation("node required"),t)}a.options(t,e);return await this.consul._put(t,a.empty)}}Agent.Check=r;Agent.Service=n;t.P=Agent},578:(e,t,s)=>{const r=s(447);const n=s(321);class AgentCheck{constructor(e){this.consul=e}async list(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.list",path:"/agent/checks"};n.options(t,e);return await this.consul._get(t,n.body)}async register(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.register",path:"/agent/check/register",type:"json"};try{t.body=n.createCheck(e)}catch(e){throw this.consul._err(r.Validation(e.message),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async deregister(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.deregister",path:"/agent/check/deregister/{id}",params:{id:e.id}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async pass(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.pass",path:"/agent/check/pass/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}if(e.note)t.query.note=e.note;n.options(t,e);return await this.consul._put(t,n.empty)}async warn(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.warn",path:"/agent/check/warn/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}if(e.note)t.query.note=e.note;n.options(t,e);return await this.consul._put(t,n.empty)}async fail(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.check.fail",path:"/agent/check/fail/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}if(e.note)t.query.note=e.note;n.options(t,e);return await this.consul._put(t,n.empty)}}t.Q=AgentCheck},752:(e,t,s)=>{const r=s(447);const n=s(321);class AgentService{constructor(e){this.consul=e}async list(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.service.list",path:"/agent/services"};n.options(t,e);return await this.consul._get(t,n.body)}async register(e){if(typeof e==="string"){e={name:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.service.register",path:"/agent/service/register",type:"json",body:{}};if(!e.name){throw this.consul._err(r.Validation("name required"),t)}try{t.body=n.createService(e)}catch(e){throw this.consul._err(r.Validation(e.message),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async deregister(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.service.deregister",path:"/agent/service/deregister/{id}",params:{id:e.id}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async maintenance(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"agent.service.maintenance",path:"/agent/service/maintenance/{id}",params:{id:e.id},query:{enable:e.enable}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}if(typeof e.enable!=="boolean"){throw this.consul._err(r.Validation("enable required"),t)}if(e.reason)t.query.reason=e.reason;n.options(t,e);return await this.consul._put(t,n.empty)}}t.R=AgentService},530:(e,t,s)=>{const r=s(575).r;const n=s(226).p;const o=s(118).a;const a=s(321);class Catalog{constructor(e){this.consul=e;this.connect=new Catalog.Connect(e);this.node=new Catalog.Node(e);this.service=new Catalog.Service(e)}async datacenters(e){e=a.normalizeKeys(e);e=a.defaults(e,this.consul._defaults);const t={name:"catalog.datacenters",path:"/catalog/datacenters"};a.options(t,e);return await this.consul._get(t,a.body)}nodes(...e){return this.node.list(...e)}services(...e){return this.service.list(...e)}}Catalog.Connect=r;Catalog.Node=n;Catalog.Service=o;t.g=Catalog},575:(e,t,s)=>{const r=s(447);const n=s(321);class CatalogConnect{constructor(e){this.consul=e}async nodes(e){if(typeof e==="string"){e={service:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"catalog.connect.nodes",path:"/catalog/connect/{service}",params:{service:e.service},query:{}};if(!e.service){throw this.consul._err(r.Validation("service required"),t)}n.options(t,e);return await this.consul._get(t,n.body)}}t.r=CatalogConnect},226:(e,t,s)=>{const r=s(447);const n=s(321);class CatalogNode{constructor(e){this.consul=e}async list(e){if(typeof e==="string"){e={dc:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"catalog.node.list",path:"/catalog/nodes"};n.options(t,e);return await this.consul._get(t,n.body)}async services(e){if(typeof e==="string"){e={node:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"catalog.node.services",path:"/catalog/node/{node}",params:{node:e.node}};if(!e.node){throw this.consul._err(r.Validation("node required"),t)}n.options(t,e);return await this.consul._get(t,n.body)}}t.p=CatalogNode},118:(e,t,s)=>{const r=s(447);const n=s(321);class CatalogService{constructor(e){this.consul=e}async list(e){if(typeof e==="string"){e={dc:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"catalog.service.list",path:"/catalog/services",query:{}};n.options(t,e);return await this.consul._get(t,n.body)}async nodes(e){if(typeof e==="string"){e={service:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"catalog.service.nodes",path:"/catalog/service/{service}",params:{service:e.service},query:{}};if(!e.service){throw this.consul._err(r.Validation("service required"),t)}if(e.tag)t.query.tag=e.tag;n.options(t,e);return await this.consul._get(t,n.body)}}t.a=CatalogService},720:(e,t)=>{t.DEFAULT_OPTIONS=["consistent","dc","stale","timeout","token","wait","wan"];t.AGENT_STATUS=["none","alive","leaving","left","failed"];t.CHECK_STATE=["unknown","passing","warning","critical"];const s=t.DURATION_UNITS={ns:1};s.us=1e3*s.ns;s.ms=1e3*s.us;s.s=1e3*s.ms;s.m=60*s.s;s.h=60*s.m},774:(e,t,s)=>{const r=s(107);const n=s(11).W;const o=s(282).P;const a=s(530).g;const i=s(37).j;const c=s(281).S;const u=s(906).Kv;const l=s(806).A;const d=s(849).z;const f=s(569).q;const p=s(258).R;const h=s(488).Y;const y=s(321);class Consul extends r.Client{constructor(e){e=y.defaults({},e);if(!e.baseUrl){e.baseUrl=(e.secure?"https:":"http:")+"//"+(e.host||"127.0.0.1")+":"+(e.port||8500)+"/v1"}e.name="consul";e.type="json";let t;if(!e.agent){t=y.getAgent(e.baseUrl);if(t){e.agent=t}}let s;if(e.defaults){s=y.defaultCommonOptions(e.defaults)}delete e.defaults;super(e);if(s)this._defaults=s;this.acl=new Consul.Acl(this);this.agent=new Consul.Agent(this);this.catalog=new Consul.Catalog(this);this.event=new Consul.Event(this);this.health=new Consul.Health(this);this.kv=new Consul.Kv(this);this.query=new Consul.Query(this);this.session=new Consul.Session(this);this.status=new Consul.Status(this);this.transaction=new Consul.Transaction(this)}destroy(){if(this._opts.agent&&this._opts.agent.destroy){this._opts.agent.destroy()}}watch(e){return new Consul.Watch(this,e)}static parseQueryMeta(e){return y.parseQueryMeta(e)}}Consul.Acl=n;Consul.Agent=o;Consul.Catalog=a;Consul.Event=i;Consul.Health=c;Consul.Kv=u;Consul.Query=l;Consul.Session=d;Consul.Status=f;Consul.Transaction=h;Consul.Watch=p;t.Consul=Consul},447:(e,t)=>{"use strict";function create(e){const t=e instanceof Error?e:new Error(e?e:undefined);t.isConsul=true;return t}function validation(e){const t=create(e);t.isValidation=true;return t}t.Consul=create;t.Validation=validation},37:(e,t,s)=>{const r=s(447);const n=s(321);class Event{constructor(e){this.consul=e}async fire(e){let t;if(arguments.length===2){t={name:arguments[0],payload:arguments[1]}}else if(typeof e==="string"){t={name:e}}else{t=e}t=n.normalizeKeys(t);t=n.defaults(t,this.consul._defaults);const s={name:"event.fire",path:"/event/fire/{name}",params:{name:t.name},query:{}};if(!t.name){throw this.consul._err(r.Validation("name required"),s)}let o;if(t.hasOwnProperty("payload")){o=Buffer.isBuffer(t.payload);s.body=o?t.payload:Buffer.from(t.payload)}if(t.node)s.query.node=t.node;if(t.service)s.query.service=t.service;if(t.tag)s.query.tag=t.tag;n.options(s,t);return await this.consul._put(s,n.body).then((e=>{if(e.hasOwnProperty("Payload")){e.Payload=n.decode(e.Payload,{buffer:o})}return e}))}async list(e){if(typeof e==="string"){e={name:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"event.list",path:"/event/list",query:{}};if(e.name)t.query.name=e.name;n.options(t,e);return await this.consul._get(t,n.body).then((t=>{t.forEach((t=>{if(t.hasOwnProperty("Payload")){t.Payload=n.decode(t.Payload,e)}}));return t}))}}t.j=Event},281:(e,t,s)=>{const r=s(720);const n=s(447);const o=s(321);class Health{constructor(e){this.consul=e}async node(e){if(typeof e==="string"){e={node:e}}e=o.normalizeKeys(e);e=o.defaults(e,this.consul._defaults);const t={name:"health.node",path:"/health/node/{node}",params:{node:e.node}};if(!e.node){throw this.consul._err(n.Validation("node required"),t)}o.options(t,e);return await this.consul._get(t,o.body)}async checks(e){if(typeof e==="string"){e={service:e}}e=o.normalizeKeys(e);e=o.defaults(e,this.consul._defaults);const t={name:"health.checks",path:"/health/checks/{service}",params:{service:e.service}};if(!e.service){throw this.consul._err(n.Validation("service required"),t)}o.options(t,e);return await this.consul._get(t,o.body)}async service(e){if(typeof e==="string"){e={service:e}}e=o.normalizeKeys(e);e=o.defaults(e,this.consul._defaults);const t={name:"health.service",path:"/health/service/{service}",params:{service:e.service},query:{}};if(!e.service){throw this.consul._err(n.Validation("service required"),t)}if(e.tag)t.query.tag=e.tag;if(e.passing)t.query.passing="true";o.options(t,e);return await this.consul._get(t,o.body)}async state(e){if(typeof e==="string"){e={state:e}}e=o.normalizeKeys(e);e=o.defaults(e,this.consul._defaults);const t={name:"health.state",path:"/health/state/{state}",params:{state:e.state}};if(!e.state){throw this.consul._err(n.Validation("state required"),t)}if(e.state!=="any"&&r.CHECK_STATE.indexOf(e.state)<0){throw this.consul._err(n.Validation("state invalid: "+e.state),t)}o.options(t,e);return await this.consul._get(t,o.body)}}t.S=Health},519:(e,t,s)=>{const{Consul:r}=s(774);e.exports=r},906:(e,t,s)=>{const r=s(447);const n=s(321);class Kv{constructor(e){this.consul=e}async get(e){if(typeof e==="string"){e={key:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"kv.get",path:"/kv/{key}",params:{key:e.key||""},query:{}};if(e.recurse)t.query.recurse="true";if(e.raw){t.query.raw="true";t.buffer=true}n.options(t,e);return await this.consul._get(t,(function(t,s){const r=t.res;if(r&&r.statusCode===404){return s(false,undefined,n.responseResult(t))}if(t.err){n.applyErrorResponse(t);return s(t.err)}if(e.raw){return s(false,undefined,n.responseResult(t,r.body))}if(r.body&&Array.isArray(r.body)&&r.body.length){r.body.forEach((t=>{if(t.hasOwnProperty("Value")){t.Value=n.decode(t.Value,e)}}))}else{return s(false,undefined,n.responseResult(t))}if(!e.recurse){return s(false,undefined,n.responseResult(t,r.body[0]))}s(false,undefined,n.responseResult(t,r.body))}))}async keys(e){if(typeof e==="string"){e={key:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"kv.keys",path:"/kv/{key}",params:{key:e.key||""},query:{keys:true}};if(e.separator)t.query.separator=e.separator;n.options(t,e);return await this.consul._get(t,n.body)}async set(e){let t;switch(arguments.length){case 3:t=arguments[2];t.key=arguments[0];t.value=arguments[1];break;case 2:t={key:arguments[0],value:arguments[1]};break;default:t=e}t=n.normalizeKeys(t);t=n.defaults(t,this.consul._defaults);const s={name:"kv.set",path:"/kv/{key}",params:{key:t.key},query:{},type:"text",body:t.value||""};if(!t.key){throw this.consul._err(r.Validation("key required"),s)}if(!t.hasOwnProperty("value")){throw this.consul._err(r.Validation("value required"),s)}if(t.hasOwnProperty("cas"))s.query.cas=t.cas;if(t.hasOwnProperty("flags"))s.query.flags=t.flags;if(t.hasOwnProperty("acquire"))s.query.acquire=t.acquire;if(t.hasOwnProperty("release"))s.query.release=t.release;n.options(s,t);return await this.consul._put(s,n.body)}async del(e){if(typeof e==="string"){e={key:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"kv.del",path:"/kv/{key}",params:{key:e.key||""},query:{}};if(e.recurse)t.query.recurse="true";if(e.hasOwnProperty("cas"))t.query.cas=e.cas;n.options(t,e);return await this.consul._delete(t,n.body)}delete(){return this.del.apply(this,arguments)}}t.Kv=Kv},806:(e,t,s)=>{const r=s(447);const n=s(321);class Query{constructor(e){this.consul=e}async list(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.list",path:"/query"};n.options(t,e);return await this.consul._get(t,n.body)}async create(e){if(typeof e==="string"){e={service:{service:e}}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.create",path:"/query",query:{},type:"json"};this._params(t,e);if(!t.body.Service||!t.body.Service.Service){throw this.consul._err(r.Validation("service required"),t)}n.options(t,e,{near:true});return await this.consul._post(t,n.body)}async get(e){if(typeof e==="string"){e={query:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.get",path:"/query/{query}",params:{query:e.query},query:{}};if(!e.query){throw this.consul._err(r.Validation("query required"),t)}n.options(t,e);return await this.consul._get(t,n.bodyItem)}async update(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.update",path:"/query/{query}",params:{query:e.query},query:{},type:"json"};if(!e.query){throw this.consul._err(r.Validation("query required"),t)}this._params(t,e);if(!t.body.Service||!t.body.Service.Service){throw this.consul._err(r.Validation("service required"),t)}n.options(t,e,{near:true});return await this.consul._put(t,n.empty)}async destroy(e){if(typeof e==="string"){e={query:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.destroy",path:"/query/{query}",params:{query:e.query},query:{}};if(!e.query){throw this.consul._err(r.Validation("query required"),t)}n.options(t,e);return await this.consul._delete(t,n.empty)}async execute(e){if(typeof e==="string"){e={query:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.execute",path:"/query/{query}/execute",params:{query:e.query},query:{}};if(!e.query){throw this.consul._err(r.Validation("query required"),t)}n.options(t,e);return await this.consul._get(t,n.body)}async explain(e){if(typeof e==="string"){e={query:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"query.explain",path:"/query/{query}/explain",params:{query:e.query},query:{}};if(!e.query){throw this.consul._err(r.Validation("query required"),t)}n.options(t,e);return await this.consul._get(t,n.bodyItem)}_params(e,t){const s=e.body||{};if(t.name)s.Name=t.name;if(t.session)s.Session=t.session;if(t.token){s.Token=t.token;delete t.token}if(t.near)s.Near=t.near;if(t.template){const e=n.normalizeKeys(t.template);if(e.type||e.regexp){s.Template={};if(e.type)s.Template.Type=e.type;if(e.regexp)s.Template.Regexp=e.regexp}}if(t.service){const e=n.normalizeKeys(t.service);s.Service={};if(e.service)s.Service.Service=e.service;if(e.failover){const t=n.normalizeKeys(e.failover);if(typeof t.nearestn==="number"||t.datacenters){s.Service.Failover={};if(typeof t.nearestn==="number"){s.Service.Failover.NearestN=t.nearestn}if(t.datacenters){s.Service.Failover.Datacenters=t.datacenters}}}if(typeof e.onlypassing==="boolean"){s.Service.OnlyPassing=e.onlypassing}if(e.tags)s.Service.Tags=e.tags}if(t.dns){const e=n.normalizeKeys(t.dns);if(e.ttl)s.DNS={TTL:e.ttl}}e.body=s}}t.A=Query},849:(e,t,s)=>{const r=s(447);const n=s(321);class Session{constructor(e){this.consul=e}async create(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.create",path:"/session/create",query:{},type:"json",body:{}};if(e.lockdelay)t.body.LockDelay=e.lockdelay;if(e.name)t.body.Name=e.name;if(e.node)t.body.Node=e.node;if(e.checks)t.body.Checks=e.checks;if(e.behavior)t.body.Behavior=e.behavior;if(e.ttl)t.body.TTL=e.ttl;n.options(t,e);return await this.consul._put(t,n.body)}async destroy(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.destroy",path:"/session/destroy/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.empty)}async info(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.info",path:"/session/info/{id}",params:{id:e.id},query:{}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._get(t,n.bodyItem)}get(e){return this.info(e)}async node(e){if(typeof e==="string"){e={node:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.node",path:"/session/node/{node}",params:{node:e.node}};if(!e.node){throw this.consul._err(r.Validation("node required"),t)}n.options(t,e);return await this.consul._get(t,n.body)}async list(e){e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.list",path:"/session/list"};n.options(t,e);return await this.consul._get(t,n.body)}async renew(e){if(typeof e==="string"){e={id:e}}e=n.normalizeKeys(e);e=n.defaults(e,this.consul._defaults);const t={name:"session.renew",path:"/session/renew/{id}",params:{id:e.id}};if(!e.id){throw this.consul._err(r.Validation("id required"),t)}n.options(t,e);return await this.consul._put(t,n.body)}}t.z=Session},569:(e,t,s)=>{const r=s(321);class Status{constructor(e){this.consul=e}async leader(e){e=r.normalizeKeys(e);e=r.defaults(e,this.consul._defaults);const t={name:"status.leader",path:"/status/leader"};r.options(t,e);return await this.consul._get(t,r.body)}async peers(e){e=r.normalizeKeys(e);e=r.defaults(e,this.consul._defaults);const t={name:"status.peers",path:"/status/peers"};r.options(t,e);return await this.consul._get(t,r.body)}}t.q=Status},488:(e,t,s)=>{const r=s(447);const n=s(321);class Transaction{constructor(e){this.consul=e}async create(e){let t;switch(arguments.length){case 2:t=n.clone(arguments[1]);t.operations=e;break;case 1:t={operations:e};break;default:throw this.consul._err(r.Validation("a list of operations are required as first arguments"),{name:"Transaction.create"})}t=n.normalizeKeys(t);t=n.defaults(t,this.consul._defaults);const s={name:"Transaction.create",path:"/txn",params:{},query:{},type:"json",body:t.operations};if(!(Array.isArray(t.operations)&&t.operations.length>0)){throw this.consul._err(r.Validation("operations must be an array with at least one item"),s)}n.options(s,t);return await this.consul._put(s,n.body)}}t.Y=Transaction},321:(e,t,s)=>{"use strict";const r=s(605);const n=s(211);const o=s(720);function getAgent(e){if(!e)return;let t;if(typeof e==="string"){t=!!e.match(/^https:/i)}else if(e.protocol){t=e.protocol==="https:"}else{return}const s=t?n.Agent:r.Agent;return new s({keepAlive:true})}function responseResult(e,...t){if(e.ctx&&e.ctx.includeResponse){return[e.res,...t]}else{return t[0]}}function applyErrorResponse(e){if(e.err&&e.ctx&&e.ctx.includeResponse){e.err.response=e.res}}function body(e,t){if(e.err){applyErrorResponse(e);return t(false,e.err)}t(false,undefined,responseResult(e,e.res.body))}function bodyItem(e,t){if(e.err){applyErrorResponse(e);return t(false,e.err)}if(e.res.body&&e.res.body.length){return t(false,undefined,responseResult(e,e.res.body[0]))}t(false,undefined,responseResult(e))}function empty(e,t){if(e.err){applyErrorResponse(e);return t(false,e.err)}t(false,undefined,responseResult(e))}function normalizeKeys(e){const t={};if(e){for(const s in e){if(e.hasOwnProperty(s)){t[s.replace(/_/g,"").toLowerCase()]=e[s]}}}return t}function defaults(e){if(!e)e={};let t;for(let s=0;s<arguments.length;s++){t=arguments[s];for(const s in t){if(t.hasOwnProperty(s)&&!e.hasOwnProperty(s)){e[s]=t[s]}}}return e}function parseDuration(e){if(typeof e==="number")return e/1e6;if(typeof e!=="string")return;let t;let s=e.match(/^(\d*\.?\d*)$/);if(s){t=parseFloat(s[1]);if(!isNaN(t))return t/1e6}s=e.match(/^([\d.]*)(ns|us|ms|s|m|h)$/);if(!s)return;t=parseFloat(s[1]);if(isNaN(t))return;return t*o.DURATION_UNITS[s[2]]/1e6}function options(e,t,s){if(!t)t={};if(!s)s={};if(!e.headers)e.headers={};if(t.hasOwnProperty("token")&&!s.token)e.headers["x-consul-token"]=t.token;if(!e.query)e.query={};if(t.dc&&!s.dc)e.query.dc=t.dc;if(t.wan&&!s.wan)e.query.wan="1";if(t.consistent&&!s.consistent){e.query.consistent="1"}else if(t.stale&&!s.stale){e.query.stale="1"}if(t.hasOwnProperty("index")&&!s.index)e.query.index=t.index;if(t.hasOwnProperty("wait")&&!s.wait)e.query.wait=t.wait;if(t.hasOwnProperty("near")&&!s.near)e.query.near=t.near;if(t.hasOwnProperty("node-meta")&&!s["node-meta"]){e.query["node-meta"]=t["node-meta"]}if(t.hasOwnProperty("filter")&&!s.filter)e.query.filter=t.filter;if(t.hasOwnProperty("ctx")&&!s.ctx)e.ctx=t.ctx;if(t.hasOwnProperty("timeout")&&!s.timeout){if(typeof t.timeout==="string"){e.timeout=parseDuration(t.timeout)}else{e.timeout=t.timeout}}}function defaultCommonOptions(e){e=normalizeKeys(e);let t;o.DEFAULT_OPTIONS.forEach((function(s){if(!e.hasOwnProperty(s))return;if(!t)t={};t[s]=e[s]}));return t}function decode(e,t){if(typeof e!=="string")return e;e=Buffer.from(e,"base64");if(!t||!t.buffer)e=e.toString();return e}function clone(e){const t={};for(const s in e){if(e.hasOwnProperty(s)){t[s]=e[s]}}return t}function setTimeoutContext(e,t,s){let r;const cancel=function(){clearTimeout(r)};r=setTimeout((function(){t.removeListener("cancel",cancel);e()}),s);t.once("cancel",cancel)}function _createTaggedAddress(e){const t={};if(e.hasOwnProperty("address"))t.Address=e.address;if(e.hasOwnProperty("port"))t.Port=e.port;return t}function _createTaggedAddresses(e){const t={};if(e.lan){t.lan=_createTaggedAddress(normalizeKeys(e.lan))}if(e.wan){t.wan=_createTaggedAddress(normalizeKeys(e.wan))}return t}function _createServiceCheck(e){const t={};if((e.grpc||e.http||e.tcp||e.args||e.script)&&e.interval){if(e.grpc){t.GRPC=e.grpc;if(e.hasOwnProperty("grpcusetls"))t.GRPCUseTLS=e.grpcusetls}else if(e.http){t.HTTP=e.http;if(e.hasOwnProperty("tlsskipverify"))t.TLSSkipVerify=e.tlsskipverify}else if(e.tcp){t.TCP=e.tcp}else{if(e.args){t.Args=e.args}else{t.Script=e.script}if(e.hasOwnProperty("dockercontainerid"))t.DockerContainerID=e.dockercontainerid;if(e.hasOwnProperty("shell"))t.Shell=e.shell}t.Interval=e.interval;if(e.hasOwnProperty("timeout"))t.Timeout=e.timeout}else if(e.ttl){t.TTL=e.ttl}else if(e.aliasnode||e.aliasservice){if(e.hasOwnProperty("aliasnode"))t.AliasNode=e.aliasnode;if(e.hasOwnProperty("aliasservice"))t.AliasService=e.aliasservice}else{throw new Error("args/grpc/http/tcp and interval, ttl, or aliasnode/aliasservice")}if(e.hasOwnProperty("notes"))t.Notes=e.notes;if(e.hasOwnProperty("status"))t.Status=e.status;if(e.hasOwnProperty("deregistercriticalserviceafter")){t.DeregisterCriticalServiceAfter=e.deregistercriticalserviceafter}if(e.hasOwnProperty("failuresbeforecritical")){t.FailuresBeforeCritical=e.failuresbeforecritical}if(e.hasOwnProperty("successbeforepassing")){t.SuccessBeforePassing=e.successbeforepassing}return t}function createServiceCheck(e){return _createServiceCheck(normalizeKeys(e))}function _createServiceProxy(e){const t={};if(e.destinationservicename){t.DestinationServiceName=e.destinationservicename}else{throw Error("destinationservicename required")}if(e.destinationserviceid)t.DestinationServiceID=e.destinationserviceid;if(e.localserviceaddress)t.LocalServiceAddress=e.localserviceaddress;if(e.hasOwnProperty("localserviceport"))t.LocalServicePort=e.localserviceport;if(e.config)t.Config=e.config;if(e.upstreams)t.Upstreams=e.upstreams;if(e.meshgateway)t.MeshGateway=e.meshgateway;if(e.expose)t.Expose=e.expose;return t}function _createService(e,t){const s={};if(e.name)s.Name=e.name;if(e.id)s.ID=e.id;if(e.tags)s.Tags=e.tags;if(e.meta)s.Meta=e.meta;if(e.hasOwnProperty("address"))s.Address=e.address;if(e.hasOwnProperty("port"))s.Port=e.port;if(Array.isArray(e.checks)){s.Checks=e.checks.map(createServiceCheck)}else if(e.check){s.Check=createServiceCheck(e.check)}if(e.connect){const r=normalizeKeys(e.connect);s.Connect={};if(r.hasOwnProperty("native"))s.Connect.Native=r.native;if(r.proxy){s.Connect.Proxy=_createServiceProxy(normalizeKeys(r.proxy))}if(r.sidecarservice){if(!t){s.Connect.SidecarService=_createService(normalizeKeys(r.sidecarservice),true)}else{throw new Error("sidecarservice cannot be nested")}}}if(e.proxy){s.Proxy=_createServiceProxy(normalizeKeys(e.proxy))}if(e.taggedaddresses){s.TaggedAddresses=_createTaggedAddresses(normalizeKeys(e.taggedaddresses))}return s}function createService(e){return _createService(normalizeKeys(e))}function createCheck(e){e=normalizeKeys(e);const t=_createServiceCheck(e);if(e.name){t.Name=e.name}else{throw new Error("name required")}if(e.hasOwnProperty("id"))t.ID=e.id;if(e.hasOwnProperty("serviceid"))t.ServiceID=e.serviceid;return t}function hasIndexChanged(e,t){if(typeof e!=="string"||!e)return false;if(typeof t!=="string"||!t)return true;return e!==t}function parseQueryMeta(e){const t={};if(e&&e.headers){if(e.headers["x-consul-index"]){t.LastIndex=e.headers["x-consul-index"]}if(e.headers["x-consul-lastcontact"]){t.LastContact=parseInt(e.headers["x-consul-lastcontact"],10)}if(e.headers["x-consul-knownleader"]){t.KnownLeader=e.headers["x-consul-knownleader"]==="true"}if(e.headers["x-consul-translate-addresses"]){t.AddressTranslationEnabled=e.headers["x-consul-translate-addresses"]==="true"}}return t}t.getAgent=getAgent;t.responseResult=responseResult;t.applyErrorResponse=applyErrorResponse;t.body=body;t.bodyItem=bodyItem;t.decode=decode;t.empty=empty;t.normalizeKeys=normalizeKeys;t.defaults=defaults;t.options=options;t.defaultCommonOptions=defaultCommonOptions;t.clone=clone;t.parseDuration=parseDuration;t.setTimeoutContext=setTimeoutContext;t.createServiceCheck=createServiceCheck;t.createService=createService;t.createCheck=createCheck;t.hasIndexChanged=hasIndexChanged;t.parseQueryMeta=parseQueryMeta},258:(e,t,s)=>{const r=s(614);const n=s(447);const o=s(321);class Watch extends r.EventEmitter{constructor(e,t){super();this.consul=e;t=o.normalizeKeys(t);let s=o.normalizeKeys(t.options||{});s=o.defaults(s,e._defaults);s.wait=s.wait||"30s";s.index=s.index||"0";if(typeof s.timeout!=="string"&&typeof s.timeout!=="number"){const e=o.parseDuration(s.wait);s.timeout=Math.ceil(e+Math.max(e*.1,500))}let r=100;if(t.hasOwnProperty("backofffactor")&&typeof t.backofffactor==="number"){r=t.backofffactor}let a=30*1e3;if(t.hasOwnProperty("backoffmax")&&typeof t.backoffmax==="number"){a=t.backoffmax}let i=-1;if(t.hasOwnProperty("maxattempts")&&typeof t.maxattempts==="number"){i=t.maxattempts}this._context={consul:e};this._options=s;this._attempts=0;this._maxAttempts=i;this._backoffMax=a;this._backoffFactor=r;this._method=t.method;this.includeResponse=true;if(typeof t.method!=="function"){throw n.Validation("method required")}process.nextTick((()=>this._run()))}isRunning(){return!this._end}updateTime(){return this._updateTime}end(){if(this._end)return;this._end=true;this.emit("cancel");this.emit("end")}_wait(){this._attempts+=1;if(this._attemptsMaxed){return this._backoffMax}const e=Math.pow(2,this._attempts)*this._backoffFactor;if(e<this._backoffMax){return e}else{this._attemptsMaxed=true;return this._backoffMax}}_err(e,t){if(this._end)return;this.emit("error",e,t);if(e&&e.isValidation)return this.end();if(t&&t.statusCode===400)return this.end();if(this._maxAttempts>=0&&this._attempts>=this._maxAttempts)return this.end();o.setTimeoutContext((()=>{this._run()}),this,this._wait())}_run(){if(this._end)return;const e=o.clone(this._options);e.ctx=this;this._method.call(this._context,e).then((([e,t])=>{this._updateTime=+new Date;this._attempts=0;this._attemptsMaxed=false;const s=e.headers["x-consul-index"];if(s===undefined){return this._err(n.Validation("Watch not supported"),e)}if(o.hasIndexChanged(s,this._options.index)){this._options.index=s;this.emit("change",t,e)}process.nextTick((()=>{this._run()}))})).catch((e=>{this._err(e,e.response)}))}}t.R=Watch},494:(e,t,s)=>{"use strict";const r=s(614);const n=s(605);const o=s(211);const a=s(669);const i=s(761);const c=s(893);const u=s(408);const l=s(603);class Client extends r.EventEmitter{constructor(e){super();e=e||{};if(typeof e==="string"||e instanceof URL){e={baseUrl:e}}else{e=l.merge(e)}if(!e.baseUrl){throw new c.ValidationError("baseUrl required")}if(!(e.baseUrl instanceof URL)){if(typeof e.baseUrl!=="string"){throw new c.ValidationError("baseUrl must be a string: "+e.baseUrl)}e.baseUrl=new URL(e.baseUrl)}const t={};t.protocol=e.baseUrl.protocol;t.hostname=e.baseUrl.hostname;if(e.baseUrl.username)t.auth=e.baseUrl.username;if(e.baseUrl.password){t.auth=(t.auth||"")+":"+e.baseUrl.password}if(e.baseUrl.port)t.port=e.baseUrl.port;if(!e.baseUrl.pathname||e.baseUrl.pathname==="/"){t.path=""}else if(e.baseUrl.pathname[e.baseUrl.pathname.length-1]==="/"){throw new c.ValidationError("baseUrl must not end with a forward slash")}else{t.path=e.baseUrl.pathname}e.baseUrl=t;e.headers=l.mergeHeaders(e.headers);if(e.tags){if(Array.isArray(e.tags)){e.tags=e.tags.slice(0)}else{throw new c.ValidationError("tags must be an array")}}else{e.tags=[]}if(e.name&&!~e.tags.indexOf(e.name)){e.tags.push(e.name)}e.encoders=l.merge(i.ENCODERS,e.encoders);e.decoders=l.merge(i.DECODERS,e.decoders);this._opts=e;this._exts={}}_err(e,t){if(!e)return e;if(!(e instanceof Error))e=new Error(e);if(t&&t.name){e.message=a.format("%s: %s",t.name,e.message)}if(this._opts.name){e.message=a.format("%s: %s",this._opts.name,e.message)}return e}_ext(e,t){if(!e||typeof e!=="string"){throw this._err(new c.ValidationError("extension eventName required"))}if(typeof t!=="function"){throw this._err(new c.ValidationError("extension callback required"))}if(!this._exts[e])this._exts[e]=[];this._exts[e].push(t)}_plugin(e,t){if(!e){throw this._err(new c.ValidationError("plugin required"))}if(typeof e.register!=="function"){throw this._err(new c.ValidationError("plugin must have register function"))}const s=e.register.attributes;if(!s){throw this._err(new c.ValidationError("plugin attributes required"))}if(!s.name){throw this._err(new c.ValidationError("plugin attributes name required"))}if(!s.version){throw this._err(new c.ValidationError("plugin attributes version required"))}return e.register(this,t||{})}_log(e,t){return this.emit("log",e,t)}_encode(e,t){if(!this._opts.encoders[e]){throw new c.CodecError("unknown encoder: "+e)}try{return this._opts.encoders[e](t)}catch(t){t.message="encode ("+e+") failed: "+t.message;throw new c.CodecError(t)}}_decode(e,t){if(!this._opts.decoders[e]){throw new c.CodecError("unknown decoder: "+e)}try{return this._opts.decoders[e](t)}catch(t){t.message="decode ("+e+") failed: "+t.message;throw new c.CodecError(t)}}__push(e,t){if(this._exts[t]){e._stack.push.apply(e._stack,this._exts[t])}if(e.opts&&e.opts.exts&&e.opts.exts[t]){if(Array.isArray(e.opts.exts[t])){e._stack.push.apply(e._stack,e.opts.exts[t])}else{e._stack.push(e.opts.exts[t])}}}_request(e){if(!e)e={};const t={opts:e,state:{}};if(e.ctx instanceof r.EventEmitter){t.ctx=e.ctx}e.tags=(e.tags||[]).concat(this._opts.tags);if(e.name&&!~e.tags.indexOf(e.name)){e.tags.push(e.name)}if(!e.headers)e.headers={};if(!e.params)e.params={};if(!e.query)e.query={};t.retry=()=>{if(t._retryable===false){throw new c.ValidationError("request is not retryable")}this._log(["papi","request","retry"].concat(t.opts.tags));delete t.body;delete t.err;delete t.req;delete t.res;delete t.transport;this.__pipeline(t)};t._stack=[];this.__push(t,"onCreate");t._stack.push(this.__create);this.__push(t,"onRequest");t._stack.push(this.__execute);this.__push(t,"onResponse");t._stack.push.apply(t._stack,Array.prototype.slice.call(arguments,1));return new Promise(((e,s)=>{t._resolve=e;t._reject=s;this.__pipeline(t)}))}__pipeline(e){const t=this;let s=0;function next(r,n,o){if(r)return e._reject(t._err(r,e.opts));if(r===false){if(n instanceof Error){return e._reject(n)}else if(!n&&o){n=o}return e._resolve(n)}const a=e._stack[s++];if(a){a.call(t,e,next)}else if(e.err){e._reject(t._err(e.err,e.opts))}else{e._resolve(e.res)}}next()}__create(e,t){const s=e.opts;let r=s.path;if(typeof r!=="string"){return t(new c.ValidationError("path required"))}const a=l.mergeHeaders(this._opts.headers,s.headers);try{r=r.replace(/\{(\w+)\}/g,((e,t)=>{if(!s.params.hasOwnProperty(t)){throw new c.ValidationError("missing param: "+t)}let r=s.params[t]||"";return r.encode===false&&r.toString?r.toString():encodeURIComponent(r)}))}catch(e){return t(e)}if(!l.isEmpty(s.query)){try{r+="?"+this._encode("application/x-www-form-urlencoded",s.query).toString()}catch(e){return t(e)}}if(s.body!==undefined){let r=i.MIME_ALIAS[s.type]||a["content-type"]||i.MIME_ALIAS[this._opts.type];let n=typeof s.body==="function";if(n){try{e.body=s.body()}catch(e){return t(e)}}else{e.body=s.body}const o=Buffer.isBuffer(e.body);const u=l.isReadableStream(e.body);if(!o&&!u&&!r){return t(new c.ValidationError("type required"))}if(!o&&!u){if(this._opts.encoders[r]){try{e.body=this._encode(r,e.body)}catch(e){return t(e)}}else{return t(new c.CodecError("type is unknown: "+r))}}if(!a["content-type"]&&r){a["content-type"]=r+"; charset="+i.CHARSET}if(u){if(!n)e._retryable=false}else{a["content-length"]=e.body.length}}else if(!~i.EXCLUDE_CONTENT_LENGTH.indexOf((s.method||"").toUpperCase())){a["content-length"]=0}if(s.pipe){const r=typeof s.pipe==="function";if(r){try{e.pipe=s.pipe()}catch(e){return t(e)}}else{e.pipe=s.pipe;e._retryable=false}if(!l.isWritableStream(e.pipe)){return t(new c.ValidationError("pipe must be a writable stream"))}}e.req=l.merge(l.pick(this._opts,i.CLIENT_OPTIONS),this._opts.socketPath?l.pick(this._opts.baseUrl,"auth","path"):l.pick(this._opts.baseUrl,"auth","hostname","port","path"),l.pick(s,i.REQUEST_OPTIONS),{headers:a});e.req.path+=r;if(this._opts.baseUrl.protocol==="https:"){e.transport=o;if(!e.req.port&&!this._opts.socketPath){e.req.port=443}}else{e.transport=n;if(!e.req.port&&!this._opts.socketPath){e.req.port=80}}t()}__execute(e,t){if(e.ctx){if(e.ctx.canceled===true){return t(new c.ValidationError("ctx already canceled"))}else if(e.ctx.finished===true){return t(new c.ValidationError("ctx already finished"))}}let s=false;const r=e.opts;let o;let a;let i=r.hasOwnProperty("timeout")?r.timeout:this._opts.timeout;this._log(["papi","request"].concat(r.tags),e.req);const d=e.transport.request(e.req);const f=d.getHeader("user-agent");if(f===undefined){d.setHeader("user-agent","papi/"+u.version)}else if(f===null){d.removeHeader("user-agent")}d.on("error",(n=>{this._log(["papi","request","error"].concat(r.tags),n);if(s)return;s=true;if(o)e.ctx.removeListener("cancel",o);if(a)clearTimeout(a);e.err=n;t()}));if(e.ctx){o=()=>{d.abort();d.emit("error",new c.AbortError("request aborted"))};e.ctx.once("cancel",o)}if(i&&i>0){a=setTimeout((()=>{d.emit("timeout");d.abort()}),i);d.setTimeout(i)}d.on("timeout",(e=>{this._log(["papi","request","error","timeout"].concat(r.tags));if(e){e=new c.TimeoutError(e)}else{e=new c.TimeoutError("request timed out ("+i+"ms)")}d.emit("error",e)}));d.on("response",(i=>{let u=[];let l=0;this._log(["papi","response"].concat(r.tags),{method:r.method,path:d.path,statusCode:i.statusCode,headers:i.headers,remoteAddress:i.socket&&i.socket.remoteAddress,remotePort:i.socket&&i.socket.remotePort});e.res=i;if(e.pipe){i.pipe(e.pipe)}else{i.on("data",(e=>{u.push(e);l+=e.length}))}i.on("end",(()=>{if(s)return;s=true;if(o)e.ctx.removeListener("cancel",o);if(a)clearTimeout(a);let d;if(l){i.body=Buffer.concat(u,l);if(!r.buffer){d=(i.headers["content-type"]||"").split(";")[0].trim();if(this._opts.decoders[d]){try{i.body=this._decode(d,i.body)}catch(s){e.err=s;return t()}}}}if(Math.floor(i.statusCode/100)!==2){let t;if(i.body&&d==="text/plain"&&i.body.length<80){t=i.body}if(!t){if(n.STATUS_CODES[i.statusCode]){t=n.STATUS_CODES[i.statusCode].toLowerCase()}else{t="request failed: "+i.statusCode}}e.err=new c.ResponseError(t,i)}t()}))}));if(l.isReadableStream(e.body)){e.body.pipe(d)}else{d.end(e.body)}}__shortcut(e,t){let s;let r=t[0];if(typeof r==="string"){s=Array.prototype.slice.call(t);s[0]=r={path:r}}else if(!r){s=Array.prototype.slice.call(t);s[0]=r={}}else{s=t}r.method=e;return this._request.apply(this,s)}_options(){return this.__shortcut("OPTIONS",arguments)}_get(){return this.__shortcut("GET",arguments)}_head(){return this.__shortcut("HEAD",arguments)}_post(){return this.__shortcut("POST",arguments)}_put(){return this.__shortcut("PUT",arguments)}_delete(){return this.__shortcut("DELETE",arguments)}_del(){return this.__shortcut("DELETE",arguments)}_patch(){return this.__shortcut("PATCH",arguments)}}t.K=Client},34:(e,t,s)=>{"use strict";const r=s(191);const n={encode:e=>Buffer.from(e,"utf8"),decode:e=>Buffer.isBuffer(e)?e.toString():e};const o={encode:e=>n.encode(JSON.stringify(e)),decode:e=>JSON.parse(n.decode(e))};const a={encode:e=>n.encode(r.stringify(e)),decode:e=>r.parse(n.decode(e))};t.json=o;t.form=a;t.text=n},761:(e,t,s)=>{"use strict";const r=s(34);t.CHARSET="utf-8";t.ENCODERS=Object.freeze({"application/json":r.json.encode,"application/x-www-form-urlencoded":r.form.encode,"text/plain":r.text.encode});t.DECODERS=Object.freeze({"application/json":r.json.decode,"application/x-www-form-urlencoded":r.form.decode,"text/html":r.text.decode,"text/json":r.json.decode,"text/plain":r.text.decode});t.MIME_ALIAS=Object.freeze({form:"application/x-www-form-urlencoded",json:"application/json",qs:"application/x-www-form-urlencoded",querystring:"application/x-www-form-urlencoded",text:"text/plain"});t.EXCLUDE_CONTENT_LENGTH=Object.freeze(["GET","HEAD","OPTIONS"]);t.CLIENT_OPTIONS=Object.freeze(["agent","createConnection","family","hints","localAddress","localPort","lookup","maxHeaderSize","setHost","socketPath","ca","cert","ciphers","clientCertEngine","crl","dhparam","ecdhCurve","honorCipherOrder","key","passphrase","pfx","rejectUnauthorized","secureOptions","secureProtocol","servername","sessionIdContext"]);t.REQUEST_OPTIONS=Object.freeze(t.CLIENT_OPTIONS.concat(["method"]))},893:(e,t)=>{"use strict";class PapiError extends Error{constructor(e){if(e instanceof Error){super(e.message);this.cause=e}else{super(e)}this.isPapi=true}}class CodecError extends PapiError{constructor(e){super(e);this.isCodec=true}}class ResponseError extends PapiError{constructor(e,t){super(e);this.isResponse=true;this.response=t}get statusCode(){return this.response.statusCode}}class AbortError extends PapiError{constructor(e){super(e);this.isAbort=true}}class TimeoutError extends PapiError{constructor(e){super(e);this.isTimeout=true}}class ValidationError extends PapiError{constructor(e){super(e);this.isValidation=true}}t.PapiError=PapiError;t.CodecError=CodecError;t.ResponseError=ResponseError;t.AbortError=AbortError;t.TimeoutError=TimeoutError;t.ValidationError=ValidationError},107:(e,t,s)=>{"use strict";const r=s(494).K;const n=s(34);const o=s(893);const a=s(171);const i=s(105);t.Client=r;t.PapiError=o.PapiError;t.CodecError=o.CodecError;t.ResponseError=o.ResponseError;t.AbortError=o.AbortError;t.TimeoutError=o.TimeoutError;t.ValidationError=o.ValidationError;t.request=a.request;t.get=a.method("GET");t.head=a.method("HEAD");t.post=a.method("POST");t.put=a.method("PUT");t.del=t.delete=a.method("DELETE");t.patch=a.method("PATCH");t.codecs=n;t.tools=i},171:(e,t,s)=>{"use strict";const r=s(494).K;const n=s(893);async function request(e){if(typeof e==="string"||e instanceof URL){arguments[0]=e={method:"get",url:e}}else{e=e||{}}if(!e.url){throw new n.ValidationError("url required")}let t;if(typeof e.url==="string"){t=new URL(e.url)}else if(e.url instanceof URL){t=e.url}else{throw new n.ValidationError("url must be a string")}e.path=t.pathname.replace("%7B","{").replace("%7D","}");t=new URL("/",t);const s=new r({baseUrl:t});delete e.url;return await s._request.apply(s,arguments)}function method(e){return async function(t){if(typeof t==="string"||t instanceof URL){arguments[0]=t={url:t}}else{t=t||{}}t.method=e;return await request.apply(null,arguments)}}t.method=method;t.request=request},105:(e,t,s)=>{"use strict";const r=s(669);function walk(e,t,s){switch(arguments.length){case 1:t=e.name;s={name:t};break;case 2:s={name:t};break;case 3:break;default:throw new Error("invalid arguments")}Object.getOwnPropertyNames(e.prototype).forEach((t=>{if(t==="constructor")return;const r=e.prototype[t];if(!t.match(/^[a-z]+/))return;if(!s.methods)s.methods={};s.methods[t]={name:t,value:r};const n=e.meta||{};s.methods[t].type=n[t]&&n[t].type||"promise"}));Object.keys(e).forEach((t=>{const r=e[t];if(!t.match(/^[A-Z]+/))return;if(!s.objects)s.objects={};s.objects[t]={name:t,value:r};walk(r,t,s.objects[t])}));return s}function callbackify(e){if(!e)throw new Error("client required");const patch=(e,t)=>{Object.keys(t.methods).forEach((s=>{const n=t.methods[s];const o=e[n.name];if(n.type==="promise"){e[n.name]=r.callbackify(o)}}));if(t.objects){Object.keys(t.objects).forEach((s=>{const r=s[0].toLowerCase()+s.slice(1);patch(e[r],t.objects[s])}))}};patch(e,walk(e.constructor))}t.callbackify=callbackify;t.walk=walk},603:(e,t)=>{"use strict";function isEmpty(e){if(!e)return true;for(let t in e){if(e.hasOwnProperty(t))return false}return true}function isStream(e){return e!==null&&typeof e==="object"&&typeof e.pipe==="function"}function isReadableStream(e){return isStream(e)&&e.readable!==false}function isWritableStream(e){return isStream(e)&&e.writable!==false}function merge(){const e={};for(let t=0;t<arguments.length;t++){const s=arguments[t];if(s!=null){for(const t in s){if(Object.prototype.hasOwnProperty.call(s,t)){e[t]=s[t]}}}}return e}function mergeHeaders(){const e={};for(let t=0;t<arguments.length;t++){const s=arguments[t];if(s!=null){for(const t in s){if(Object.prototype.hasOwnProperty.call(s,t)){e[t.toLowerCase()]=s[t]}}}}return e}function pick(e){let t=arguments;let s=1;if(t.length===2&&Array.isArray(t[1])){t=t[1];s=0}const r={};for(let n=s;n<t.length;n++){const s=t[n];if(e.hasOwnProperty(s)){r[s]=e[s]}}return r}t.isEmpty=isEmpty;t.isReadableStream=isReadableStream;t.isWritableStream=isWritableStream;t.merge=merge;t.mergeHeaders=mergeHeaders;t.pick=pick},408:e=>{"use strict";e.exports=JSON.parse('{"name":"papi","version":"1.1.0","description":"Build HTTP API clients","main":"lib","devDependencies":{"debug":"^4.1.1","jscs":"^3.0.7","jshint":"^2.9.5","lodash":"^4.17.10","mocha":"^8.3.0","nock":"^13.0.7","nyc":"^15.1.0","request":"^2.87.0","should":"^13.2.1","sinon":"^9.2.4"},"engines":{"node":">=10.0.0"},"scripts":{"cover":"nyc --reporter=lcov _mocha --recursive && open coverage/lcov-report/index.html","test":"jshint lib test && jscs lib test && nyc _mocha --recursive --check-leaks --globals Promise && nyc check-coverage --statements 100 --functions 100 --branches 100 --lines 100"},"repository":{"type":"git","url":"https://github.com/silas/node-papi.git"},"keywords":["api","client","http","rest"],"author":"Silas Sewell <silas@sewell.org>","license":"MIT","bugs":{"url":"https://github.com/silas/node-papi/issues"},"homepage":"https://github.com/silas/node-papi"}')},614:e=>{"use strict";e.exports=require("events")},747:e=>{"use strict";e.exports=require("fs")},605:e=>{"use strict";e.exports=require("http")},211:e=>{"use strict";e.exports=require("https")},87:e=>{"use strict";e.exports=require("os")},622:e=>{"use strict";e.exports=require("path")},191:e=>{"use strict";e.exports=require("querystring")},669:e=>{"use strict";e.exports=require("util")}};var t={};function __nccwpck_require__(s){var r=t[s];if(r!==undefined){return r.exports}var n=t[s]={exports:{}};var o=true;try{e[s].call(n.exports,n,n.exports,__nccwpck_require__);o=false}finally{if(o)delete t[s]}return n.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var s={};(()=>{const e=__nccwpck_require__(186);const{run:t}=__nccwpck_require__(139);t(e)})();module.exports=s})();